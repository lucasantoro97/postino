services:
  agent:
    build: .
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data:/data
    environment:
      AGENT_DATA_DIR: /data
      DEADLINE_REGEX_FALLBACK: "false"

  auth-google:
    build: .
    profiles: ["auth"]
    env_file:
      - .env
    environment:
      AGENT_DATA_DIR: /data
      DEADLINE_REGEX_FALLBACK: "false"
    volumes:
      - ./data:/data
      - ${GOOGLE_OAUTH_CLIENT_SECRET_JSON}:/run/secrets/google_client.json:ro
    ports:
      - "8080:8080"
    command:
      [
        "agente-email-auth-google",
        "--client-secret",
        "/run/secrets/google_client.json",
        "--token",
        "/data/google_token.json",
        "--port",
        "8080",
      ]
